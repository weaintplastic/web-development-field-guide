<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Create a Migration File</title>
    <meta name="description" content="" />
    <meta name="author" content="Roland Lösslein">
    <link rel="icon" href="../../../../templates/weaintplastic/themes/daux-weaintplastic/" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../../../../templates/weaintplastic/themes/daux-weaintplastic/css/daux-weaintplastic.css' rel='stylesheet' type='text/css'>
</head>
<body>
            <!-- Docs -->
                <div class="container-fluid fluid-height wrapper">
            <div class="navbar navbar-fixed-top hidden-print">
                <div class="container-fluid">
                    <a class="brand navbar-brand" href="../../../../Outline"><span>Web Development Field Guide</span></a>
                </div>
            </div>
            <div class="row columns content">
                <div class="left-column article-tree col-sm-3 hidden-print">
                    <!-- For Mobile -->
                    <div class="responsive-collapse">
                        <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                    </div>
                    <div id="sub-nav-collapse" class="sub-nav-collapse">
                        <!-- Navigation -->
                        <ul class="nav nav-list"><li><a href="../../../../Outline.html">Outline</a></li><li><a href="#" class="aj-nav folder">Environment</a><ul class="nav nav-list"><li><a href="../../../../Environment/Local_Development_Environment/index.html" class="folder">Local Development Environment</a><ul class="nav nav-list"><li><a href="../../../../Environment/Local_Development_Environment/Xampp_&_Mamp.html">Xampp & Mamp</a></li><li><a href="../../../../Environment/Local_Development_Environment/Vagrant.html">Vagrant</a></li></ul></li><li><a href="../../../../Environment/Tools_and_Software.html">Tools and Software</a></li></ul></li><li><a href="#" class="aj-nav folder">Development</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/index.html" class="folder">Frontend Development</a><ul class="nav nav-list"><li><a href="#" class="aj-nav folder">Setting up your project</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/The_Project_Ecosystem.html">The Project Ecosystem</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/index.html" class="folder">Setup Dependency Managers</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Node_Package_Manager/index.html" class="folder">Node Package Manager</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Node_Package_Manager/Install_NPM.html">Install NPM</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Node_Package_Manager/Initialize_NPM_on_a_new_project.html">Initialize NPM on a new project</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Node_Package_Manager/Initialize_NPM_on_an_existing_project.html">Initialize NPM on an existing project</a></li></ul></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Bower/index.html" class="folder">Bower</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Bower/Install_Bower.html">Install Bower</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Bower/Initialize_Bower_on_a_new_Project.html">Initialize Bower on a new Project</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Bower/Initialize_Bower_on_an_existing_Project.html">Initialize Bower on an existing Project</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Bower/Add_dependencies_with_Bower.html">Add dependencies with Bower</a></li></ul></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Composer/index.html" class="folder">Composer</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Composer/Install_Composer.html">Install Composer</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Composer/Initialize_Composer_on_a_new_Project.html">Initialize Composer on a new Project</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Dependency_Managers/Composer/Initialize_Composer_on_an_existing_Project.html">Initialize Composer on an existing Project</a></li></ul></li></ul></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Build_System/index.html" class="folder">Setup Build System</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Build_System/Setup_Gulp.html">Setup Gulp</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Build_System/A_simple_Gulp_build_script.html">A simple Gulp build script</a></li><li><a href="../../../../Development/Frontend_Development/Setting_up_your_project/Setup_Build_System/A_complex_Gulp_build_script.html">A complex Gulp build script</a></li></ul></li></ul></li><li><a href="#" class="aj-nav folder">Writing CSS</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Use_preprocessors.html">Use preprocessors</a></li><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Write_Object_Oriented_CSS.html">Write Object Oriented CSS</a></li><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Follow_a_Naming_Convention.html">Follow a Naming Convention</a></li><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Structure_your_CSS.html">Structure your CSS</a></li><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Go_mobile_first.html">Go mobile first</a></li><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Use_feature_detection.html">Use feature detection</a></li><li><a href="../../../../Development/Frontend_Development/Writing_CSS/Use_3rd_Party_Code_and_Frameworks.html">Use 3rd Party Code and Frameworks</a></li></ul></li><li><a href="#" class="aj-nav folder">Writing Javascript</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Writing_Javascript/Write_Object_Oriented_Javascript.html">Write Object Oriented Javascript</a></li><li><a href="../../../../Development/Frontend_Development/Writing_Javascript/Write_jQuery_Plugins.html">Write jQuery Plugins</a></li><li><a href="../../../../Development/Frontend_Development/Writing_Javascript/Structure_your_Javascript.html">Structure your Javascript</a></li><li><a href="../../../../Development/Frontend_Development/Writing_Javascript/Optimize_your_Javascript.html">Optimize your Javascript</a></li><li><a href="../../../../Development/Frontend_Development/Writing_Javascript/Use_3rd_Party_Code_and_Frameworks.html">Use 3rd Party Code and Frameworks</a></li></ul></li><li><a href="#" class="aj-nav folder">Writing HTML</a><ul class="nav nav-list"><li><a href="../../../../Development/Frontend_Development/Writing_HTML/Provide_static_templates.html">Provide static templates</a></li><li><a href="../../../../Development/Frontend_Development/Writing_HTML/Structure_your_HTML.html">Structure your HTML</a></li><li><a href="../../../../Development/Frontend_Development/Writing_HTML/Provide_Styleguides.html">Provide Styleguides</a></li></ul></li></ul></li></ul></li><li class="open"><a href="../../../../Collaboration/index.html" class="folder">Collaboration</a><ul class="nav nav-list"><li><a href="#" class="aj-nav folder">Working with Git</a><ul class="nav nav-list"><li><a href="#" class="aj-nav folder">Git Workflow</a><ul class="nav nav-list"><li><a href="../../../../Collaboration/Working_with_Git/Git_Workflow/The_Concept_of_Gitflow.html">The Concept of Gitflow</a></li><li><a href="../../../../Collaboration/Working_with_Git/Git_Workflow/Working_with_Gitflow.html">Working with Gitflow</a></li><li><a href="../../../../Collaboration/Working_with_Git/Git_Workflow/Gitflow_with_Sourctree.html">Gitflow with Sourctree</a></li><li><a href="../../../../Collaboration/Working_with_Git/Git_Workflow/FAQ.html">FAQ</a></li></ul></li><li><a href="../../../../Collaboration/Working_with_Git/Git_Conflict_Sloving.html">Git Conflict Sloving</a></li></ul></li><li class="open"><a href="#" class="aj-nav folder">Database Versioning</a><ul class="nav nav-list"><li><a href="../../../../Collaboration/Database_Versioning/The_Concept_of_Database_Versioning.html">The Concept of Database Versioning</a></li><li class="open"><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/index.html" class="folder">Working with Database Versioning</a><ul class="nav nav-list"><li><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Initialize_Database_Versioning_on_a_new_project.html">Initialize Database Versioning on a new project</a></li><li><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Initialize_Database_Versioning_on_an_existing_project.html">Initialize Database Versioning on an existing project</a></li><li class="open"><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Working_with_migrations/index.html" class="folder">Working with migrations</a><ul class="nav nav-list"><li class="active"><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Working_with_migrations/Create_a_Migration_File.html">Create a Migration File</a></li><li><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Working_with_migrations/Status_of_your_database.html">Status of your database</a></li><li><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Working_with_migrations/Upgrade_your_database.html">Upgrade your database</a></li><li><a href="../../../../Collaboration/Database_Versioning/Working_with_Database_Versioning/Working_with_migrations/Downgrade_your_database.html">Downgrade your database</a></li></ul></li></ul></li></ul></li></ul></li><li><a href="#" class="aj-nav folder">Testing</a><ul class="nav nav-list"><li><a href="#" class="aj-nav folder">Frontend Testing</a><ul class="nav nav-list"><li><a href="../../../../Testing/Frontend_Testing/Testing_Strategy.html">Testing Strategy</a></li><li><a href="../../../../Testing/Frontend_Testing/Cross-Browser_Testing.html">Cross-Browser Testing</a></li><li><a href="../../../../Testing/Frontend_Testing/Cross-Device_Testing.html">Cross-Device Testing</a></li><li><a href="../../../../Testing/Frontend_Testing/Styleguide-Driven_Testing.html">Styleguide-Driven Testing</a></li><li><a href="../../../../Testing/Frontend_Testing/Automated_Testing.html">Automated Testing</a></li></ul></li></ul></li><li><a href="../../../../Deployment.html">Deployment</a></li><li><a href="#" class="aj-nav folder">Documentation</a><ul class="nav nav-list"><li><a href="../../../../Documentation/Documentation_with_README.md.html">Documentation with README</a></li><li><a href="../../../../Documentation/Documentation_with_Styleguides.html">Documentation with Styleguides</a></li><li><a href="../../../../Documentation/Share_Project_Credentials.html">Share Project Credentials</a></li></ul></li><li><a href="../../../../Optimization.html">Optimization</a></li></ul>                                                    <div class="well well-sidebar">

                                <!-- Links -->
                                <a href="https://twitter.com/weaintplastic" target="_blank">Follow @weaintplastic</a><br>                                
                                <!-- Twitter -->
                                                            </div>
                                            </div>
                </div>
                <div class="right-column  content-area col-sm-9">
                    <div class="content-page col-lg-offset-2 col-lg-8">
                        <article>
                                                            <div class="page-header sub-header clearfix">
                                    <h1>Create a Migration File                                                                            </h1>
                                    <span style="float: left; font-size: 10px; color: gray;">
                                        Tuesday, June 16, 2015                                    </span>
                                    <span style="float: right; font-size: 10px; color: gray;">
                                        7:11 AM                                    </span>
                                </div>
                            
                            <p>A migration file holds information about the things that need to be done in order to transform a database from one state into another and how to revert this transformation. So a patch file always provides update and rollback statements for the transformation.</p>
<p>Using Phinx, a patch file is a PHP file located in <code>db/migrations</code> of your project. Creating such a migration file you have to execute the following statement on your command line:</p>
<pre><code>php vendor/bin/phinx create &lt;name&gt;</code></pre>
<p><code>&lt;name&gt;</code> is the name of your patch file written in <code>CamelCaseSyntax</code>. You can either create a path file for each table, while the <code>&lt;name&gt;</code> is the name of your branch or the name of the affected table.</p>
<blockquote>
<p>We recommend to name your patch file after the branch you are working in.</p>
</blockquote>
<p>Imagine you are working on a feature that adds a blog functionality to our website. You'll probably create at least one new page template that needs to be shared with your coworkers. Since our feature branch is called <code>feature/blog</code>, the statement to create a new patch file will look like this:</p>
<pre><code>php vendor/bin/phinx create FeatureBlog</code></pre>
<p>The created patch file <code>YYYYMMDDHHMMSS_feature_blog.php</code> (YYYYMMDDHHMMSS will be replaced by the current time) will look like this:</p>
<pre><code>&lt;?php

use Phinx\Migration\AbstractMigration;

class FeatureBlog extends AbstractMigration
{
    /**
     * Change Method.
     *
     * More information on this method is available here:
     * http://docs.phinx.org/en/latest/migrations.html#the-change-method
     *
     * Uncomment this method if you would like to use it.
     *
    public function change() {
    }
    */

    /**
     * Migrate Up.
     */
    public function up() {
    }

    /**
     * Migrate Down.
     */
    public function down() {
    }
}</code></pre>
<p>The patch file skeleton provides you two functions <code>up</code> and <code>down</code> and a commented one, the <code>change</code> function.</p>
<ul>
<li><strong>The Up Method</strong><br>
The up method is automatically run by Phinx when you are migrating up and it detects the given migration hasn’t been executed previously. You should use the up method to transform the database with your intended changes.</li>
<li><strong>The Down Method</strong><br>
The down method is automatically run by Phinx when you are migrating down and it detects the given migration has been executed in the past. You should use the down method to reverse/undo the transformations described in the up method.</li>
<li><strong>The Change Method</strong><br>
Phinx 0.2.0 introduced a new feature called reversible migrations. With reversible migrations you only need to define the up logic and Phinx can figure out how to migrate down automatically for you. To define a reversible migration you must uncomment the change method in your migration file. Please note that this only works if you use a specific subset of Phinx' built in commands for performing changes on a database. You'll find more that in the <a href="http://docs.phinx.org/en/latest/migrations.html#the-change-method">Phinx documentation</a></li>
</ul>
<p>Phinx provides built in command in order to perform changes on the schema of a database. Since our changes need to insert data in an existing table, we need to execute plain SQL statements and therefore use the <code>execute()</code> command. Our patch file for inserting new templates into the <code>cms_templates</code> table will look like this:</p>
<pre><code>/**
 * Migrate Up.
 */
public function up()
{
    $this-&gt;execute("INSERT INTO `cms_template` (`id`, `parent_id`, `site`, `name`, `file`, `creation`, `type`, `selectable_all_users`, `snippet_names`) VALUES (NULL, '0', '1', 'Page Blog', 'versioning-demo.local/page_blog.php', '2014-10-13', '1', '0', '');");
}

/**
 * Migrate Down.
 */
public function down()
{
    $this-&gt;execute("DELETE FROM `cms_template` WHERE `name` = 'Page Blog'");
}</code></pre>
<p>Appart from the <code>execute</code> command there are a lot of other commands available to perform any sorts of database transformations. You'll find a complete list here: <a href="http://docs.phinx.org/en/latest/migrations.html">http://docs.phinx.org/en/latest/migrations.html</a>   </p>
<blockquote>
<p>Don't make your hands dirty, work with migration files, everytime you need to transform you database!</p>
</blockquote>
<p>Following the concept of database versioning you won't do any changes to the database by hand anymore. You are going to work with patch-files yourself. Everytime you are in need to change relevant things on the database, you'll create a patch file and work out the neccessary statements until they do the right thing for you.
Creating the right statements you'll use the update and rollback functionality of <code>Phinx</code> until everything looks good. Only then it is guaranteed your teammates are able to succesfully migrate their database to the needed state once they execute your migrations scripts.</p>
<p>Sometimes it is neccessary to put changes, that were automated by a system, into a migrations file by hand (e.g. when you create a template using the LOOP box backend). Since this violates the concept of database versioning and usually interupts the workflow of your migration manager you need to take care of a few things:</p>
<p>When putting changes that hve already been performed into a migration file, your migration manager will by out of sync. Since the migration file wasn't exectued by <code>Phinx</code> before, checking the <code>phinx status</code> will tell you, that you need to migrate to a newer version. Executing <code>phinx migrate</code> is the only way to get your <code>Phinx</code> environment up to data again, but this will also apply changes again and will cause errors and wrong results. Think of the migration script above. After migrating your database you'll end up with a duplicate entry in your <code>cms_template</code> table.</p>
<p>To avoid this you should add a new status to the <code>phinxlog</code> table with the current migration version ID, while the version ID are the first 14 characters of the created migration file (e.g. 20141219115236).</p>
<pre><code> version            start_time          end_time 
---------------------------------------------------------
 20141219115236     CURRENT_TIMESTAMP   CURRENT_TIMESTAMP</code></pre>
<p>After doing that you can <a href="/web-development-field-guide/Collaboration/Database_Versioning/Working_with_Database_Versioning/Working_with_migrations/Status_of_your_database">check the status of your database</a>, which should tell you that everything is up to date.</p>
<h3>More information</h3>
<p>You'll find detailed information about the process of creating migrations in the official Phinx documentation: <a href="http://docs.phinx.org/en/latest/migrations.html">http://docs.phinx.org/en/latest/migrations.html</a></p>                                                    </article>
                    </div>
                </div>
            </div>
        </div>
    
        

    <!-- jQuery -->
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined')
                document.write(unescape("%3Cscript src='../../../../js/jquery-1.11.0.min.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
    
    <!-- hightlight.js -->
    <script src="../../../../js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <!-- Front end file editor -->
        <script src="../../../../js/custom.js"></script>
    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</body>
</html>

